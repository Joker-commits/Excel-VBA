Function XLookupWithDuplicates(lookupValue As Variant, lookupRange As Range, returnRange As Range) As Variant
    Dim lookupResult As Variant
    Dim firstOccurrence As Variant
    Dim duplicateCount As Long
    
    ' Perform initial XLOOKUP
    lookupResult = Application.XLookup(lookupValue, lookupRange, returnRange)
    
    ' Check for duplicates in the main column (lookup range)
    duplicateCount = Application.CountIf(lookupRange, lookupValue)
    
    ' Find first occurrence
    firstOccurrence = Application.Match(lookupValue, lookupRange, 0)
    
    ' Handle duplicates
    If duplicateCount > 1 Then
        XLookupWithDuplicates = "Duplicate found in cell " & lookupRange(firstOccurrence).Address
    Else
        ' No duplicates, return initial lookup result
        XLookupWithDuplicates = lookupResult
    End If
End Function
