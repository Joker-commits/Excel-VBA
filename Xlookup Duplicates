Function XLookupWithDuplicates(lookupValue As Variant, lookupRange As Range, returnRange As Range) As Variant
    Dim lookupResult As Variant
    Dim firstOccurrence As Variant
    Dim duplicateCount As Long
    
    ' Check for duplicates in the lookup value column
    duplicateCount = Application.CountIf(lookupRange, lookupValue)
    
    ' Find first occurrence
    firstOccurrence = Application.Match(lookupValue, lookupRange, 0)
    
    ' Perform initial XLOOKUP
    If duplicateCount > 1 Then
        XLookupWithDuplicates = "Duplicate found in cell " & lookupRange(firstOccurrence).Address
    Else
        ' No duplicates, perform initial XLOOKUP
        lookupResult = Application.XLookup(lookupValue, lookupRange, returnRange)
        XLookupWithDuplicates = lookupResult
    End If
End Function
