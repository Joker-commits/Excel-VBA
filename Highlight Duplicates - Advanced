Sub HighlightDuplicatesWithVBA()
    Dim ws As Worksheet
    Dim rngA As Range, rngB As Range
    Dim cell As Range
    Dim selectedRange As Range
    
    ' Set the worksheet
    Set ws = ThisWorkbook.ActiveSheet ' Change to the desired worksheet if needed
    
    ' Prompt the user to select the range for comparison
    On Error Resume Next
    Set selectedRange = Application.InputBox("Select the range for comparison", Type:=8)
    On Error GoTo 0
    
    ' Check if a range is selected
    If Not selectedRange Is Nothing Then
        ' Check if the selected range contains multiple columns
        If selectedRange.Columns.Count > 1 Then
            MsgBox "Please select a single column range.", vbExclamation
            Exit Sub
        End If
        
        ' Find the last row in the selected column
        Dim lastRow As Long
        lastRow = ws.Cells(ws.Rows.Count, selectedRange.Column).End(xlUp).Row
        
        ' Define the range for Column A and Column B based on the selected range and last row
        Set rngA = ws.Range(ws.Cells(1, selectedRange.Column), ws.Cells(lastRow, selectedRange.Column))
        Set rngB = ws.Range(ws.Cells(1, selectedRange.Column + 1), ws.Cells(lastRow, selectedRange.Column + 1))
        
        ' Check if both ranges are not empty
        If Not rngA Is Nothing And Not rngB Is Nothing Then
            ' Clear existing conditional formatting
            rngA.FormatConditions.Delete
            
            ' Loop through each cell in Column A
            For Each cell In rngA
                ' Check if the cell is not empty
                If Not IsEmpty(cell) Then
                    ' Check if the value in Column A exists in Column B
                    If Not IsError(Application.Match(cell.Value, rngB, 0)) Then
                        ' Check if the value doesn't repeat in the same column
                        If WorksheetFunction.CountIf(rngA, cell.Value) = 1 Or WorksheetFunction.CountIf(rngB, cell.Value) = 1 Then
                            ' Apply conditional formatting to highlight the cell with light green color
                            cell.Interior.Color = RGB(144, 238, 144) ' Light green
                        End If
                    End If
                End If
            Next cell
        Else
            MsgBox "Invalid range selection. Please select a range that includes at least two adjacent columns.", vbExclamation
        End If
    Else
        MsgBox "No range selected.", vbExclamation
    End If
End Sub
